{% extends 'base.html' %}

{% load static %} 

{% block content %}
<header style="background-color: #a3cb64;" class="px-6 py-10 lg:py-20 w-full">
  <div class="max-w-3xl mx-auto text-center">
    <p class="mb-2 text-3xl lg:text-5xl text-white">Bienvenido a Xtreme Biking</p>

    <p class="mb-10 text-white">Prepárate para pedalear con nuestras bicicletas y accesorios de alta calidad</p>

    <a href="{% url 'product_list' %}" style="color: #a3cb64;" class="inline-block px-8 py-4 rounded-xl bg-white hover:bg-gray-200">Compra ya</a>
  </div>
</header>

<div class="max-w-6xl mx-auto py-2 px-6 xl:px-0 h-full">
  <div class="text-center py-6">
    <h2 class="text-xl font-bold text-gray-900 sm:text-3xl">
      Productos destacados
    </h2>
  </div>

  <div class="flex justify-between items-center mb-6">
    <div class="w-1/3">
      <div class="relative">
        <label for="Search" class="sr-only"> Buscar productos </label>
          <input
            type="text"
            id="Search"
            placeholder="Buscar por título"
            class="w-full rounded-md border-gray-200 py-2.5 pe-10 ps-2 shadow-sm sm:text-sm"
          />
      
          <span class="absolute inset-y-0 end-0 grid w-10 place-content-center">
            <button type="button" id="searchButton" class="text-gray-600 hover:text-gray-700">
              <span class="sr-only">Search</span>
      
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="h-4 w-4"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"
                />
              </svg>
            </button>
          </span>
      </div>
    </div>
  </div>

  <div class="products flex items-center flex-wrap">
    {% for product in featured_products %}
    <div class="w-full md:w-1/3 xl:w-1/4 p-6 product-item" data-title="{{product.title | lower}}">
      <a href="/store/product_details/{{ product.id }}">
        <img src="{{product.image_url}}" class="rounded-xl hover:shadow-lg">
      </a>
      <div class="pt-3 flex items-center justify-between">
        <a href="/store/product_details/{{ product.id }}">{{product.title}}</a>
        
        {% if product.availability == 0%}
        <p class="pt-1 text-black-400">Agotado</p>
        {% else %}
        <a href="#" style="color: #a3cb64;">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
          </svg>
        </a>
        {% endif %}
      </div>

      <p class="pt-1 text-gray-400">{{ product.price }} €</p>
    </div>
    {% endfor %}
  </div>

  <a href="{% url 'product_list' %}" style="color: #a3cb64;"  class="my-6 flex px-8 py-4 justify-center">
    Ver más 
    <svg class="mx-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#a3cb64" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h13M12 5l7 7-7 7"/></svg>
  </a>

</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    function searchProducts() {
      const searchTerm = $('#Search').val().toLowerCase();

      $.ajax({
        type: 'GET',
        url: '/store/buscar-productos/', 
        data: { search: searchTerm },
        success: function (response) {  
          // Limpiar la sección de productos
          $('.product-item').hide();
          // Mostrar solo los productos que coinciden con la búsqueda
          response.products.forEach((product) => {
            $(`.product-item[data-title*="${product.title.toLowerCase()}"]`).show();
          });
        },
        error: function (error) {
          console.error('Error en la búsqueda', error);
        }
      });
    };
    $('#searchButton').click(searchProducts);

    $('#Search').keyup(searchProducts);
  });
</script>
{% endblock %}